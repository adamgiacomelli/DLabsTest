!function(){"use strict";angular.module("dlabsApp",["ngResource","ui.router","ngMaterial","ngMdIcons","LocalStorageModule","datetime","angular-uuid","ngWebSocket"]).run(["$rootScope",function($rootScope){}])}(),function(){"use strict";angular.module("dlabsApp").config(["$stateProvider","$urlRouterProvider","$locationProvider","localStorageServiceProvider",function($stateProvider,$urlRouterProvider,$locationProvider,localStorageServiceProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"partials/core/home.html",controller:"FrontpageCtrl"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1}),localStorageServiceProvider.setPrefix("dlabs")}])}(),function(){"use strict";angular.module("dlabsApp").controller("FrontpageCtrl",["$scope","$interval","localStorageService","dWebsocket","uuid",function($scope,$interval,localStorageService,dWebsocket,uuid){function backupContent(){var change={user:$scope.user.name,timestamp:new Date,content:$scope.content.text};if(0!=$scope.changeCollection.length){var lastChangeText=$scope.changeCollection.slice(-1)[0].content;lastChangeText!=$scope.content.text&&($scope.changeCollection.push(change),dWebsocket.updateCollection($scope.changeCollection))}else $scope.changeCollection.push(change);$scope.saveToLocalStorage(),console.log("socket collection",dWebsocket.collection)}dWebsocket.initialize("ws://10.9.0.25:1234"),$scope.connection=dWebsocket.connection;var userId=uuid.v4();$scope.saveToLocalStorage=function(){var storageBox={user:$scope.user,content:$scope.content,changeCollection:$scope.changeCollection};localStorageService.set(localStorageKey,storageBox)};var localStorageKey="dlabsAppContents",localContents=localStorageService.get(localStorageKey);localContents?($scope.user=localContents.user,$scope.content=localContents.content,$scope.changeCollection=localContents.changeCollection):($scope.user={name:"Anonymous",id:userId},$scope.content={text:""},$scope.changeCollection=[],$scope.saveToLocalStorage()),$interval(backupContent,500),$scope.revertToChange=function(change){var index=$scope.changeCollection.findIndex(function(element){return element.user==change.user&&element.timestamp==change.timestamp});$scope.content.text=change.content,$scope.changeCollection.splice(index+1,$scope.changeCollection.length-index),$scope.saveToLocalStorage()}}])}(),function(){"use strict";angular.module("dlabsApp").factory("dWebsocket",function($websocket){var dataStream,collection=[],connection={connected:!1},initialize=function(socketUrl){dataStream=$websocket(socketUrl),dataStream.onMessage(function(message){console.log("websocket message arrived:",message),collection.push(JSON.parse(message.data))}),dataStream.onOpen(function(msg){console.log("opened",msg),connection.state=!0}),dataStream.onClose(function(msg){console.log("closed",msg),connection.state=!1})},update=function(change){dataStream.send(JSON.stringify(change))},updateCollection=function(collection){dataStream.send(JSON.stringify(collection))},methods={connection:connection,collection:collection,update:update,updateCollection:updateCollection,initialize:initialize};return methods})}();